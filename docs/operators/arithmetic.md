# 算術運算子

運算子是處理資料的基本方法，用來從現有的值得到新的值。JavaScript 提供了多種運算子，覆蓋了所有主要的運算。

## 概述

JavaScript 共提供10個算術運算子，用來完成基本的算術運算。

- **加法運算子**：`x + y`
- **減法運算子**： `x - y`
- **乘法運算子**： `x * y`
- **除法運算子**：`x / y`
- **指數運算子**：`x ** y`
- **餘數運算子**：`x % y`
- **自增運算子**：`++x` 或者 `x++`
- **自減運算子**：`--x` 或者 `x--`
- **數值運算子**： `+x`
- **負數值運算子**：`-x`

減法、乘法、除法運演算法比較單純，就是執行相應的數學運算。下面介紹其他幾個算術運算子，重點是加法運算子。

## 加法運算子

### 基本規則

加法運算子（`+`）是最常見的運算子，用來求兩個數值的和。

```javascript
1 + 1 // 2
```

JavaScript 允許非數值的相加。

```javascript
true + true // 2
1 + true // 2
```

上面程式碼中，第一行是兩個布林值相加，第二行是數值與布林值相加。這兩種情況，布林值都會自動轉成數值，然後再相加。

比較特殊的是，如果是兩個字串相加，這時加法運算子會變成連線運算子，返回一個新的字串，將兩個原字串連線在一起。

```javascript
'a' + 'bc' // "abc"
```

如果一個運運算元是字串，另一個運運算元是非字串，這時非字串會轉成字串，再連線在一起。

```javascript
1 + 'a' // "1a"
false + 'a' // "falsea"
```

加法運算子是在執行時決定，到底是執行相加，還是執行連線。也就是說，運運算元的不同，導致了不同的語法行為，這種現象稱為“過載”（overload）。由於加法運算子存在過載，可能執行兩種運算，使用的時候必須很小心。

```javascript
'3' + 4 + 5 // "345"
3 + 4 + '5' // "75"
```

上面程式碼中，由於從左到右的運算次序，字串的位置不同會導致不同的結果。

除了加法運算子，其他算術運算子（比如減法、除法和乘法）都不會發生過載。它們的規則是：所有運運算元一律轉為數值，再進行相應的數學運算。

```javascript
1 - '2' // -1
1 * '2' // 2
1 / '2' // 0.5
```

上面程式碼中，減法、除法和乘法運算子，都是將字串自動轉為數值，然後再運算。

### 物件的相加

如果運運算元是物件，必須先轉成原始型別的值，然後再相加。

```javascript
var obj = { p: 1 };
obj + 2 // "[object Object]2"
```

上面程式碼中，物件`obj`轉成原始型別的值是`[object Object]`，再加`2`就得到了上面的結果。

物件轉成原始型別的值，規則如下。

首先，自動呼叫物件的`valueOf`方法。

```javascript
var obj = { p: 1 };
obj.valueOf() // { p: 1 }
```

一般來說，物件的`valueOf`方法總是返回物件自身，這時再自動呼叫物件的`toString`方法，將其轉為字串。

```javascript
var obj = { p: 1 };
obj.valueOf().toString() // "[object Object]"
```

物件的`toString`方法預設返回`[object Object]`，所以就得到了最前面那個例子的結果。

知道了這個規則以後，就可以自己定義`valueOf`方法或`toString`方法，得到想要的結果。

```javascript
var obj = {
  valueOf: function () {
    return 1;
  }
};

obj + 2 // 3
```

上面程式碼中，我們定義`obj`物件的`valueOf`方法返回`1`，於是`obj + 2`就得到了`3`。這個例子中，由於`valueOf`方法直接返回一個原始型別的值，所以不再呼叫`toString`方法。

下面是自定義`toString`方法的例子。

```javascript
var obj = {
  toString: function () {
    return 'hello';
  }
};

obj + 2 // "hello2"
```

上面程式碼中，物件`obj`的`toString`方法返回字串`hello`。前面說過，只要有一個運運算元是字串，加法運算子就變成連線運算子，返回連線後的字串。

這裡有一個特例，如果運運算元是一個`Date`物件的例項，那麼會優先執行`toString`方法。

```javascript
var obj = new Date();
obj.valueOf = function () { return 1 };
obj.toString = function () { return 'hello' };

obj + 2 // "hello2"
```

上面程式碼中，物件`obj`是一個`Date`物件的例項，並且自定義了`valueOf`方法和`toString`方法，結果`toString`方法優先執行。

## 餘數運算子

餘數運算子（`%`）返回前一個運運算元被後一個運運算元除，所得的餘數。

```javascript
12 % 5 // 2
```

需要注意的是，運算結果的正負號由第一個運運算元的正負號決定。

```javascript
-1 % 2 // -1
1 % -2 // 1
```

所以，為了得到負數的正確餘數值，可以先使用絕對值函式。

```javascript
// 錯誤的寫法
function isOdd(n) {
  return n % 2 === 1;
}
isOdd(-5) // false
isOdd(-4) // false

// 正確的寫法
function isOdd(n) {
  return Math.abs(n % 2) === 1;
}
isOdd(-5) // true
isOdd(-4) // false
```

餘數運算子還可以用於浮點數的運算。但是，由於浮點數不是精確的值，無法得到完全準確的結果。

```javascript
6.5 % 2.1
// 0.19999999999999973
```

## 自增和自減運算子

自增和自減運算子，是一元運算子，只需要一個運運算元。它們的作用是將運運算元首先轉為數值，然後加上1或者減去1。它們會修改原始變數。

```javascript
var x = 1;
++x // 2
x // 2

--x // 1
x // 1
```

上面程式碼的變數`x`自增後，返回`2`，再進行自減，返回`1`。這兩種情況都會使得，原始變數`x`的值發生改變。

運算之後，變數的值發生變化，這種效應叫做運算的副作用（side effect）。自增和自減運算子是僅有的兩個具有副作用的運算子，其他運算子都不會改變變數的值。

自增和自減運算子有一個需要注意的地方，就是放在變數之後，會先返回變數操作前的值，再進行自增/自減操作；放在變數之前，會先進行自增/自減操作，再返回變數操作後的值。

```javascript
var x = 1;
var y = 1;

x++ // 1
++y // 2
```

上面程式碼中，`x`是先返回當前值，然後自增，所以得到`1`；`y`是先自增，然後返回新的值，所以得到`2`。

## 數值運算子，負數值運算子

數值運算子（`+`）同樣使用加號，但它是一元運算子（只需要一個運算元），而加法運算子是二元運算子（需要兩個運算元）。

數值運算子的作用在於可以將任何值轉為數值（與`Number`函式的作用相同）。

```javascript
+true // 1
+[] // 0
+{} // NaN
```

上面程式碼表示，非數值經過數值運算子以後，都變成了數值（最後一行`NaN`也是數值）。具體的型別轉換規則，參見《資料型別轉換》一章。

負數值運算子（`-`），也同樣具有將一個值轉為數值的功能，只不過得到的值正負相反。連用兩個負數值運算子，等同於數值運算子。

```javascript
var x = 1;
-x // -1
-(-x) // 1
```

上面程式碼最後一行的圓括號不可少，否則會變成自減運算子。

數值運算子號和負數值運算子，都會返回一個新的值，而不會改變原始變數的值。

## 指數運算子

指數運算子（`**`）完成指數運算，前一個運運算元是底數，後一個運運算元是指數。

```javascript
2 ** 4 // 16
```

注意，指數運算子是右結合，而不是左結合。即多個指數運算子連用時，先進行最右邊的計算。

```javascript
// 相當於 2 ** (3 ** 2)
2 ** 3 ** 2
// 512
```

上面程式碼中，由於指數運算子是右結合，所以先計算第二個指數運算子，而不是第一個。

## 賦值運算子

賦值運算子（Assignment Operators）用於給變數賦值。

最常見的賦值運算子，當然就是等號（`=`）。

```javascript
// 將 1 賦值給變數 x
var x = 1;

// 將變數 y 的值賦值給變數 x
var x = y;
```

賦值運算子還可以與其他運算子結合，形成變體。下面是與算術運算子的結合。

```javascript
// 等同於 x = x + y
x += y

// 等同於 x = x - y
x -= y

// 等同於 x = x * y
x *= y

// 等同於 x = x / y
x /= y

// 等同於 x = x % y
x %= y

// 等同於 x = x ** y
x **= y
```

下面是與位運算子的結合（關於位運算子，請見後文的介紹）。

```javascript
// 等同於 x = x >> y
x >>= y

// 等同於 x = x << y
x <<= y

// 等同於 x = x >>> y
x >>>= y

// 等同於 x = x & y
x &= y

// 等同於 x = x | y
x |= y

// 等同於 x = x ^ y
x ^= y
```

這些複合的賦值運算子，都是先進行指定運算，然後將得到值返回給左邊的變數。
