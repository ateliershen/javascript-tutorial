# 其他運算子，運算順序

## void 運算子

`void`運算子的作用是執行一個表示式，然後不返回任何值，或者說返回`undefined`。

```javascript
void 0 // undefined
void(0) // undefined
```

上面是`void`運算子的兩種寫法，都正確。建議採用後一種形式，即總是使用圓括號。因為`void`運算子的優先性很高，如果不使用括號，容易造成錯誤的結果。比如，`void 4 + 7`實際上等同於`(void 4) + 7`。

下面是`void`運算子的一個例子。

```javascript
var x = 3;
void (x = 5) //undefined
x // 5
```

這個運算子的主要用途是瀏覽器的書籤工具（Bookmarklet），以及在超級連結中插入程式碼防止網頁跳轉。

請看下面的程式碼。

```html
<script>
function f() {
  console.log('Hello World');
}
</script>
<a href="http://example.com" onclick="f(); return false;">點選</a>
```

上面程式碼中，點選連結後，會先執行`onclick`的程式碼，由於`onclick`返回`false`，所以瀏覽器不會跳轉到 example.com。

`void`運算子可以取代上面的寫法。

```html
<a href="javascript: void(f())">文字</a>
```

下面是一個更實際的例子，使用者點選連結提交表單，但是不產生頁面跳轉。

```html
<a href="javascript: void(document.form.submit())">
  提交
</a>
```

## 逗號運算子

逗號運算子用於對兩個表示式求值，並返回後一個表示式的值。

```javascript
'a', 'b' // "b"

var x = 0;
var y = (x++, 10);
x // 1
y // 10
```

上面程式碼中，逗號運算子返回後一個表示式的值。

逗號運算子的一個用途是，在返回一個值之前，進行一些輔助操作。

```javascript
var value = (console.log('Hi!'), true);
// Hi!

value // true
```

上面程式碼中，先執行逗號之前的操作，然後返回逗號後面的值。

## 運算順序

### 優先順序

JavaScript 各種運算子的優先級別（Operator Precedence）是不一樣的。優先順序高的運算子先執行，優先順序低的運算子後執行。

```javascript
4 + 5 * 6 // 34
```

上面的程式碼中，乘法運算子（`*`）的優先性高於加法運算子（`+`），所以先執行乘法，再執行加法，相當於下面這樣。

```javascript
4 + (5 * 6) // 34
```

如果多個運算子混寫在一起，常常會導致令人困惑的程式碼。

```javascript
var x = 1;
var arr = [];

var y = arr.length <= 0 || arr[0] === undefined ? x : arr[0];
```

上面程式碼中，變數`y`的值就很難看出來，因為這個表示式涉及5個運算子，到底誰的優先順序最高，實在不容易記住。

根據語言規格，這五個運算子的優先順序從高到低依次為：小於等於（`<=`)、嚴格相等（`===`）、或（`||`）、三元（`?:`）、等號（`=`）。因此上面的表示式，實際的運算順序如下。

```javascript
var y = ((arr.length <= 0) || (arr[0] === undefined)) ? x : arr[0];
```

記住所有運算子的優先順序，是非常難的，也是沒有必要的。

### 圓括號的作用

圓括號（`()`）可以用來提高運算的優先順序，因為它的優先順序是最高的，即圓括號中的表示式會第一個運算。

```javascript
(4 + 5) * 6 // 54
```

上面程式碼中，由於使用了圓括號，加法會先於乘法執行。

運算子的優先級別十分繁雜，且都是硬性規定，因此建議總是使用圓括號，保證運算順序清晰可讀，這對程式碼的維護和除錯至關重要。

順便說一下，圓括號不是運算子，而是一種語法結構。它一共有兩種用法：一種是把表示式放在圓括號之中，提升運算的優先順序；另一種是跟在函式的後面，作用是呼叫函式。

注意，因為圓括號不是運算子，所以不具有求值作用，只改變運算的優先順序。

```javascript
var x = 1;
(x) = 2;
```

上面程式碼的第二行，如果圓括號具有求值作用，那麼就會變成`1 = 2`，這是會報錯了。但是，上面的程式碼可以執行，這驗證了圓括號只改變優先順序，不會求值。

這也意味著，如果整個表示式都放在圓括號之中，那麼不會有任何效果。

```javascript
(expression)
// 等同於
expression
```

函式放在圓括號中，會返回函式本身。如果圓括號緊跟在函式的後面，就表示呼叫函式。

```javascript
function f() {
  return 1;
}

(f) // function f(){return 1;}
f() // 1
```

上面程式碼中，函式放在圓括號之中會返回函式本身，圓括號跟在函式後面則是呼叫函式。

圓括號之中，只能放置表示式，如果將語句放在圓括號之中，就會報錯。

```javascript
(var a = 1)
// SyntaxError: Unexpected token var
```

### 左結合與右結合

對於優先級別相同的運算子，同時出現的時候，就會有計算順序的問題。

```javascript
a OP b OP c
```

上面程式碼中，`OP`表示運算子。它可以有兩種解釋方式。

```javascript
// 方式一
(a OP b) OP c

// 方式二
a OP (b OP c)
```

上面的兩種方式，得到的計算結果往往是不一樣的。方式一是將左側兩個運算數結合在一起，採用這種解釋方式的運算子，稱為“左結合”（left-to-right associativity）運算子；方式二是將右側兩個運算數結合在一起，這樣的運算子稱為“右結合”運算子（right-to-left associativity）。

JavaScript 語言的大多數運算子是“左結合”，請看下面加法運算子的例子。

```javascript
x + y + z

// 引擎解釋如下
(x + y) + z
```

上面程式碼中，`x`與`y`結合在一起，它們的預算結果再與`z`進行運算。

少數運算子是“右結合”，其中最主要的是賦值運算子（`=`）和三元條件運算子（`?:`）。

```javascript
w = x = y = z;
q = a ? b : c ? d : e ? f : g;
```

上面程式碼的解釋方式如下。

```javascript
w = (x = (y = z));
q = a ? b : (c ? d : (e ? f : g));
```

上面的兩行程式碼，都是右側的運算數結合在一起。

另外，指數運算子（`**`）也是右結合。

```javascript
2 ** 3 ** 2
// 相當於 2 ** (3 ** 2)
// 512
```

